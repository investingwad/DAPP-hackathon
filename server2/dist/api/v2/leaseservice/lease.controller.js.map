{"version":3,"sources":["../../../../src/api/v2/leaseservice/lease.controller.js"],"names":["leaseController","dotenv","require","config","fetch","Order","Orderstat","eosaction","createClient","client","create","req","res","status","send","register_user","network","httpEndpoint","dspEndpt","service","process","env","contract","response_reg","push_liquid_account_transaction","contract_key","vaccount","user1","console","log","response_registeraction","username","balance","body","lease_amount","lease_period","vote_choice","err","create_order","orderid","getid","data","id","authorizer","stake_to","rent_amount","rent_offer","duration","resource_type","result","pushtrx","order","order_stat","apr","parseFloat","split","orderobj","save","lease_transfer","from","exchange","to","quantity","amount","memo","account_name","updateexchange","match_order","orders","aggregate","$match","$sort","vaccount_det","getvaccountdet","flag","every","element","index","item","row","order_stat_id","getorderstatid","changeorderstat","orderstat_id","filled_at","Date","setDate","getDate","sevenDaysFromNow","toISOString","orderstat","order_id","lender","rent_fee","expires_at","ordderstatres","withdraw","cancelorder","findOne","remove","exec","leaseunstake","get_orderdet","find","get_orderstatdet","get_accountblc","api","rpc","get_currency_balance","code","account","vaccount_blc","getaccountblc","params","respobj","user_exchange_blc","userblc_leased_out","userblc_staked","total_leaseout_amount","user_leased_out"],"mappings":"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","file":"lease.controller.js","sourcesContent":["let leaseController = {}\nconst dotenv = require('dotenv')\ndotenv.config()\nconst fetch = require('isomorphic-fetch')\n\nconst Order = require('./model/order.model')\nconst Orderstat = require('./model/orderstatus.model')\n\nconst eosaction = require('./eosaction/eosaction')\n\nconst { createClient } = require('@liquidapps/dapp-client')\nvar client\n// const getClient = async () => {\n//   if (client) return client\n//   client = await createClient({\n//     network: 'kylin',\n//     httpEndpoint: dspEndpt,\n//     fetch: fetch\n//   })\n//   return client\n// }\n\nleaseController.create = (req, res) => {\n  res.status(200).send('create user')\n}\n\nleaseController.register_user = async (req, res) => {\n  try {\n    let client = await createClient({\n      network: 'kylin',\n      httpEndpoint: dspEndpt,\n      fetch: fetch\n    })\n    const service = await client.service('vaccounts', process.env.contract)\n    const response_reg = await service.push_liquid_account_transaction(\n      process.env.contract,\n      process.env.contract_key,\n      'regaccount',\n      {\n        vaccount: process.env.user1 // increment to new account if fails\n      }\n    )\n    console.log('response_reg', response_reg)\n\n    const response_registeraction = await service.push_liquid_account_transaction(\n      process.env.contract,\n      process.env.contract_key,\n      'registeracc',\n      {\n        username: process.env.user1,\n        balance: req.body.lease_amount,\n        lease_period: req.body.lease_period,\n        vote_choice: req.body.vote_choice\n      }\n    )\n    console.log('response_registeraction', response_registeraction)\n    res.status(200).send('Successful')\n    // lease_transfer(req.body.lease_amount);\n  } catch (err) {\n    console.log('error-->', err)\n    res.status(400).send(err)\n  }\n}\n\nleaseController.create_order = async (req, res) => {\n  try {\n    let orderid = await eosaction.getid()\n    let data = {\n      id: orderid,\n      authorizer: req.body.authorizer,\n      stake_to: req.body.stake_to,\n      rent_amount: req.body.rent_amount,\n      rent_offer: req.body.rent_offer,\n      duration: req.body.duration,\n      resource_type: req.body.resource_type\n    }\n    const result = await eosaction.pushtrx(\n      'createorder',\n      data,\n      process.env.contract\n    )\n    console.log('result', result)\n\n    let order = new Order()\n    order.id = orderid\n    order.authorizer = req.body.authorizer\n    order.stake_to = req.body.stake_to\n    order.rent_amount = req.body.rent_amount\n    order.rent_offer = req.body.rent_offer\n    order.duration = req.body.duration\n    order.resource_type = req.body.resource_type\n    order.order_stat = 'queue'\n    order.apr =\n      parseFloat(req.body.rent_offer.split(' ')[0]) /\n      parseFloat(req.body.duration)\n\n    let orderobj = await order.save()\n    console.log('orderobj', orderobj)\n    res.status(400).send(orderobj)\n  } catch (err) {\n    console.log('error-->', err)\n    res.status(400).send(err)\n  }\n}\n\nleaseController.lease_transfer = async (req, res) => {\n  try {\n    let data = {\n      from: process.env.exchange,\n      to: process.env.contract,\n      quantity: req.body.amount,\n      memo: '1:' + req.body.account_name\n    }\n    const result = await eosaction.pushtrx('transfer', data, 'eosio.token')\n    console.log('result', result)\n    let updateexchange = await eosaction.updateexchange(\n      req.body.account_name,\n      req.body.amount,\n      'transfer'\n    )\n  } catch (err) {\n    console.log('s.m. err--', err)\n  }\n}\n\nleaseController.match_order = async (req, res) => {\n  let orders = await Order.aggregate([\n    { $match: { order_stat: 'queue' } },\n    { $sort: { apr: -1 } }\n  ])\n\n  let vaccount_det = eosaction.getvaccountdet(req.body.account_name)\n  let orderid = 0\n  let flag = 0\n  orders.every(function (element, index) {\n    // Do your thing, then:\n    if (\n      item.lease_period <= vaccount_det.row.lease_period &&\n      parseFloat(item.rent_amount.split(' ')[0]) <=\n        parseFloat(vaccount_det.row.balance.split(' ')[0])\n    ) {\n      orderid = item.id\n      flag = 1\n      return false\n    } else return true\n  })\n  if (flag == 1) {\n    let order_stat_id = await eosaction.getorderstatid()\n    let orderobj = await eosaction.changeorderstat(orderid)\n    if (orderobj) {\n      let data = {\n        vaccount: req.body.account_name,\n        id: orderid,\n        orderstat_id: order_stat_id\n      }\n      const result = await eosaction.pushtrx(\n        'checkorder',\n        data,\n        process.env.contract\n      )\n\n      let filled_at = new Date()\n      let duration = filled_at.setDate(filled_at.getDate() + duration)\n      sevenDaysFromNow = new Date(sevenDaysFromNow).toISOString()\n\n      let orderstat = new Orderstat()\n      orderstat.id = order_stat_id\n      orderstat.order_id = orderid\n      orderstat.lender = req.body.account_name\n      orderstat.authorizer = orderobj.authorizer\n      orderstat.stake_to = orderobj.stake_to\n      orderstat.rent_amount = orderobj.rent_amount\n      orderstat.rent_fee = orderobj.rent_offer\n      orderstat.expires_at = new Date(duration).toISOString().split('.')[0]\n      orderstat.filled_at = filled_at.toISOString().split('.')[0]\n\n      let ordderstatres = await orderstat.save()\n      res.status(200).send(ordderstatres)\n    }\n  } else {\n    res.status(200).send('At present no match found for this lease request')\n  }\n}\n\nleaseController.withdraw = async (req, res) => {\n  try {\n    let data = {\n      vaccount: req.body.account_name\n    }\n    const result = await eosaction.pushtrx(\n      'withdraw',\n      data,\n      process.env.contract\n    )\n    console.log('result', result)\n    let updateexchange = await eosaction.updateexchange(\n      req.body.account_name,\n      req.body.amount,\n      'withdraw'\n    )\n    res.status(400).send('Successfully withdrawn lease-out request')\n  } catch (err) {\n    console.log('error-->', err)\n    res.status(400).send(err)\n  }\n}\n\nleaseController.cancelorder = async (req, res) => {\n  try {\n    let data = {\n      orderid: req.body.order_id\n    }\n    const result = await eosaction.pushtrx(\n      'withdraw',\n      data,\n      process.env.contract\n    )\n    console.log('result', result)\n    let order = await Order.findOne({ id: order_id })\n      .remove()\n      .exec()\n\n    res.status(400).send('Successfully withdrawn order request')\n  } catch (err) {\n    console.log('error-->', err)\n    res.status(400).send(err)\n  }\n}\n\nleaseController.leaseunstake = async (req, res) => {\n  try {\n    let data = {\n      orderid: req.body.order_stat_id\n    }\n    const result = await eosaction.pushtrx(\n      'leaseunstake',\n      data,\n      process.env.contract\n    )\n    console.log('result', result)\n    let order = await Orderstat.findOne({ id: req.body.order_stat_id })\n    if (order) {\n      await Order.findOne({ id: order.order_id })\n        .remove()\n        .exec()\n      await order.remove()\n      res.status(400).send('Successfully unstaked')\n    }\n  } catch (err) {\n    console.log('error-->', err)\n    res.status(400).send(err)\n  }\n}\n\nleaseController.get_orderdet = async (req, res) => {\n  try {\n    let order = await Orderstat.find({})\n    if (order) {\n      res.status(200).send(order)\n    } else {\n      res.status(200).send('no order details found')\n    }\n  } catch (err) {\n    console.log('error-->', err)\n    res.status(400).send(err)\n  }\n}\n\nleaseController.get_orderstatdet = async (req, res) => {\n  try {\n    let orderstat = await Orderstat.find({})\n    if (orderstat) {\n      res.status(200).send(order)\n    } else {\n      res.status(200).send('no order details found')\n    }\n  } catch (err) {\n    console.log('error-->', err)\n    res.status(400).send(err)\n  }\n}\n\nleaseController.get_accountblc = async (req, res) => {\n  try {\n    let balance = await api.rpc.get_currency_balance({\n      code: 'eosio.token',\n      account: process.env.exchange\n    })\n    let vaccount_blc = getaccountblc(req.params.vaccount)\n    let respobj = {}\n    respobj.user_exchange_blc = balance\n    if (vaccount_blc.res.row) {\n      respobj.userblc_leased_out = vaccount_blc.res.row.balance\n      respobj.userblc_staked = vaccount_blc.res.row.total_leaseout_amount\n    } else respobj.user_leased_out = '0.0000 EOS'\n    res.status(200).send(respobj)\n  } catch (err) {\n    console.log('error-->', err)\n    res.status(400).send(err)\n  }\n}\n\nexport default leaseController\n/// //////////////\n"]}